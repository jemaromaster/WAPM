{% extends "base.html" %}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

{% block header %}
<title>WAPM</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
jQuery(document).ready(
function() {
	 
	$("#dialogo-listaItems")
	.dialog(
			{
				autoOpen : false,
				modal : true,
				overflow : scroll,
				resizable : false,
				width: 'auto',
				heigth: 'auto',
				
				
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				buttons : {
					/* funcion asociado al boton aceptar */
					"Salir" : function( ) {
						$(this).dialog("close")
					}
				}
			});
	
	var gridItems = jQuery("#listaItems").jqGrid(
			{

				// datatype : "local",
				// data:mydata,
				url : '/listarItems/',
				datatype : "json",
				mtype : "get",
				postData : {
					idP : '0',
					idF : '0'
				},
				//aca se pone el proyecto el cual selecciono 
				//y la fase al cual pertenece el proyecto
				colNames : [ 'ID Item', 'Nombre Item', 'Version',
						'prioridad', 'Fecha Inicio', 'Fecha Fin.',
						'tipo Item id', 'Costo','complejidad', 'Estado',
						'autorVersion_id', 'Autor', 'Descripcion',
						'Id de Proyecto' ],
				colModel : [ {
					name : 'idItem',
					index : 'idItem',
					hidden : true
				},

				{
					name : 'nombreItem',
					index : 'nombreItem',
					width : 150
				}, {
					name : 'version',
					index : 'version',
					width : 50,
					search : false
				}, {
					name : 'prioridad',
					index : 'prioridad',
					width : 200,
					hidden : true
				}, {
					name : 'fechaInicio',
					index : 'fechaInicio',
					width : 100,
					formatter : 'date',
					sorttype : 'date',
					datefmt : 'd/m/Y',
					formatoptions : {
						srcformat : 'Y-m-d',
						newformat : 'd/m/Y'
					},
					search : false
				}, {
					name : 'fechaFinalizacion',
					index : 'fechaFinalizacion',
					width : 100,
					formatter : 'date',
					sorttype : 'date',
					datefmt : 'd/m/Y',
					formatoptions : {
						srcformat : 'Y-m-d',
						newformat : 'd/m/Y'
					},
					search : false
				}, {
					name : 'tipoItem_id',
					index : 'tipoItem_id',
					width : 200,
					hidden : true
				}, {
					name : 'costo',
					index : 'costo',
					width : 100,search : false
				}, {
					name : 'complejidad',
					index : 'complejidad',
					hidden : true
				}, {
						name : 'estado',
						index : 'estado',
						formatter : 'select',
						stype : 'select',
						editoptions : {
							value : "todos:(Todos-Excep. Inactivos);activo:Activo;pendiente:Pendiente;aprobado:Aprobado;bloqueado:Bloqueado;inactivo:Inactivo;revision:Revision"
						},
						hidden : false
				}, {
					name : 'autorVersion_id',
					index : 'autorVersion_id',
					hidden : true,
					search:false
				}, {
					name : 'nombreAutorVersion',
					index : 'nombreAutorVersion'
				}, {
					name : 'descripcion',
					index : 'descripcion',
					hidden : true
				},

				{
					name : 'idFase',
					index : 'idFase',
					hidden : true
				}

				],
				sortname : 'nombreItem',
				viewrecords : true,
				rownumbers : true,
				sortorder : "desc",
				ignoreCase : true,
				pager : '#pagerItems',
				caption : "Items",
				jsonReader : {
					root : "invdata",
					page : "currpage",
					total : "totalpages",
					records : "totalrecords",
					repeatitems : false,
					id : "idItem"
				}

			}).jqGrid('navGrid', '#pagerItems', {
		edit : false,
		add : false,
		del : false,
		search : false,
		refresh : true
	});
	gridItems.jqGrid('filterToolbar', {
		stringResult : true,
		searchOnEnter : false,
		defaultSearch : "cn"
	});

	
	$("#dialogo-rolUsuario")
	.dialog(
			{
				autoOpen : false,
				modal : true,
				overflow : scroll,
				resizable : false,
				width: 'auto',
				heigth: 'auto',
				
				
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				buttons : {
					/* funcion asociado al boton aceptar */
					"Asignar" : function( ) {agregarRolUser()},
					"Quitar" : function() {quitarRolUser()}
				}
			});

	
	
	var gridRolUser = jQuery("#listRolUser").jqGrid(
			{

				// datatype : "local",
				// data:mydata,
				url : '/listarRolUsuario/',
				datatype : "json",
				mtype : "get",
				postData: { idProyecto: '0', idUsuario: '0'},
				show : {
					effect : 'fade',
					duration : 200
				},
				
				hide : {
					effect : 'fade',
					duration : 200
				},
				colNames : [ 'ID rol ', 'Nombre',
						'Descripcion','listaPermisos', 'Posee Rol' ],
				colModel : [ {
					name : 'idRol',
					index : 'idRol',
					hidden : true
				}, {
					name : 'nombre',
					index : 'nombre',
				}, {
					name : 'descripcion',
					index : 'descripcion',
					width: '250'
				}							
				, {
					name : 'listaPermisos',
					index : 'listaPermisos',
					hidden : true
				},
				{
					name : 'enUsuario',
					index : 'enUsuario',
					width : 90,
					align : "center",
					formatter : 'select',
					stype : 'select',
					
					editoptions : {
						value : "Todos:Todos;Si:Si;No:No"
					}
				}

				],
				sortname : 'nombre',
				viewrecords : true,
				rownumbers : true,
				sortorder : "desc",
				ignoreCase : true,
				pager : '#pagerRolUser',
				caption : "Lista de Roles en el Proyecto",
				jsonReader : {
					root : "invdata",
					page : "currpage",
					total : "totalpages",
					records : "totalrecords",
					repeatitems : false,
					id : "idUsuario"
				}

			}).jqGrid('navGrid', '#pagerRolUser', {
		edit : false,
		add : false,
		del : false,
		search : false,
		refresh : true
	});
	gridRolUser.jqGrid('filterToolbar', {
		stringResult : true,
		searchOnEnter : false,
		defaultSearch : "cn"
	});

	
	$("#dialogo-rolProyecto")
	.dialog(
			{
				autoOpen : false,
				modal : true,
				overflow : scroll,
				resizable : false,
				width : 'auto',
				heigth: 'auto',
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				buttons : {
					/* funcion asociado al boton aceptar */
					"Aceptar" : function() {
						/* si el dato es nuevo se llamar a la url para agregar */
						if (banderaRol == 1) {
							/* se indica la URL */
							if (controlRol(true) == 1) {
								mostrarMensaje("Error",
										"Campos completados incorrectamente");
							} else {
								$.post('/agregarRolProyecto/',{
												/* se indican los parametros*/
												nombre : $(
														"#nombreRol")
														.val(),
												idFase : $(
												"#comboFase").val(),
												descripcion : $("#descripcionRol").val(), 
												idRol: "0"
												},
												function(data, status) {
													/* funcion que maneja el resulado de la invocación */

													/* si hay error se muestra el mensaje*/
													if (data.substring(
															0, 1) == 't') {
														mostrarMensaje(
																"Error",
																"Los datos no se han podido guardar:\n"
																		+ data
																				.substring(2));
														/* se indica que no hubieron errores */
													} else {
														$(
																"#dialogo-rolProyecto")
																.dialog(
																		"close");
														mostrarMensaje(
																"Exito",
																data
																		.substring(2));
													}
													/* se indicar la recarga de la tabla */
													$('#listRoles')
															.trigger(
																	"reloadGrid");
												});
							}

							/* si el dato se modifica se llama a la url para modificar*/
						} else if (banderaRol == 2) {
							if (controlRol(false) == 1) {
								mostrarMensaje("Error",
										"Campos completados incorrectamente");
							} else {
								var row = $('#listRoles').jqGrid('getGridParam', 'selrow');
								rowdata = $('#listRoles').getRowData(row);
								
								/* se indica la url */
								$.post('/modificarRolProyecto/',
												{
													idRol: $("#idRol").val(),
													nombre : $("#nombreRol").val(),
													descripcion : $("#descripcionRol").val(),
													estado: rowdata.estado
												},
												function(data, status) {

													if (data.substring(
															0, 1) == 't') {
														mostrarMensaje(
																"Error",
																"Los datos no se han podido modificar:\n"
																		+ data
																				.substring(2));
													} else {
														$(
																"#dialogo-rolProyecto")
																.dialog(
																		"close");
														mostrarMensaje(
																"Exito",
																"Los datos han sido modificados");
													}
													$('#listRoles')
															.trigger(
																	"reloadGrid");
												});
							}
						} else if (banderaRol == 3) {
							$(this).dialog("close");
						}
					},
					"Cancelar" : function() {
						$(this).dialog("close");
					}
				}
			});

	
	
	
	
	var gridPermisos = jQuery("#listPermisos").jqGrid(
			{
				
				// datatype : "local",
				// data:mydata,
				url : '/listarPermisosRol/',
				datatype : "json",
				width : 'auto',
				mtype : "get",
				postData : {
					idRol : '0'
				},
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				colNames : [ 'idPermiso','Nombre ', 'Descripcion', 'Asignado a Rol'],
				colModel : [ {
					name : 'idPermiso',
					index : 'idPermiso',
					
					hidden : true
				}, {
					name : 'nombre',
					index : 'nombre',
					
				}, {
					name : 'descripcion',
					index : 'descripcion',
					width: '250'
				}, {
					name : 'enRol',
					index : 'enRol',
					align : "center",
					
					formatter : 'select',
					stype : 'select',
					
					editoptions : {
						value : "Todos:Todos;Si:Si;No:No"
					},
				}],
				sortname : 'nombre',
				viewrecords : true,
				rownumbers : true,
				sortorder : "desc",
				ignoreCase : true,
				pager : '#pagerPermisos',
				caption : "Lista de Permisos",
				jsonReader : {
					root : "invdata",
					page : "currpage",
					total : "totalpages",
					records : "totalrecords",
					repeatitems : false,
					id : "idPermiso"
				}

			}).jqGrid('navGrid', '#pagerPermisos', {
		edit : false,
		add : false,
		del : false,
		search : false,
		refresh : false
	});
	gridPermisos.jqGrid('filterToolbar', {
		stringResult : true,
		searchOnEnter : false,
		defaultSearch : "cn"
	});

	
	$('#dialogo-permisos')
	.dialog(
			{
				autoOpen : false,
				modal : true,
				resizable : true,
				width : 'auto',
				heigth: 'auto',
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				buttons : {
					/* funcion asociado al boton aceptar */
					"Agregar" : function() {
						/* se pregunta si es que se selecciono la fila en proyectos, y en lel grid de users */
						var rowPermisos = $('#listPermisos').jqGrid(
								'getGridParam', 'selrow');
						var rowRol = $('#listRoles').jqGrid(
								'getGridParam', 'selrow');
						
						if (rowPermisos == null) {
							mostrarMensaje("Atencion",
									"Seleccione el Usuario a agregar");
							return;
						}
						if (rowRol == null) {
							mostrarMensaje("Atencion",
									"Seleccione el Rol");
							return;
						}

						var rowdata = $('#listRoles')
								.getRowData(rowRol);
						
						var rowdataPermisos = $('#listPermisos')
								.getRowData(rowPermisos);
						/* se indica la URL */
						
						$.post('/agregarPermisoRol/',
										{ /* se indican los parametros*/
											idRol : rowdata.idRol,
											idPermiso : rowdataPermisos.idPermiso

										},
										function(data, status) {
											/* funcion que maneja el resultruc : $("#ruc").val(),ado de la invocación */

											/* si hay error se muestra el mensaje*/
											if (data.substring(0, 1) == 't') {
												mostrarMensaje(
														"Error",
														"Los datos no se han podido guardar:\n"
																+ data
																		.substring(2));
												/* se indica que no hubieron errores */
											} else {
												mostrarMensaje(
														"Exito",
														data
																.substring(2));
											}
											/* se indicar la recarga de la tabla */
											$('#listPermisos').trigger(
													"reloadGrid");
										});
					},
					"Quitar" : function() {
						var rowPermisos = $('#listPermisos').jqGrid(
								'getGridParam', 'selrow');
						if (rowPermisos == null) {
							mostrarMensaje("Atencion",
									"Seleccione el Permiso a eliminar");
							return;
						}
						var rowRol = $('#listRoles').jqGrid(
								'getGridParam', 'selrow');
						if (rowRol == null) {
							mostrarMensaje("Atencion",
									"Seleccione el Rol");
							return;
						}

						var rowdata = $('#listRoles')
								.getRowData(rowRol);
						var rowdataPermisos = $('#listPermisos')
								.getRowData(rowPermisos);
						/* se indica la url */
						$.post('/quitarPermisoRol/',
										{
											idRol : rowdata.idRol,
											idPermiso : rowdataPermisos.idPermiso
										},
										function(data, status) {

											if (data.substring(0, 1) == 't') {
												mostrarMensaje(
														"Error",
														"Permiso no se ha podido quitar:\n"
																+ data
																		.substring(2));
											} else {
												mostrarMensaje("Exito",
														"Permiso ha sido quitado del Rol");
											}
											$('#listPermisos').trigger(
													"reloadGrid");
										});
					},
					"Salir" : function() {
						$(this).dialog("close");
					}
				}
			});

	
	
	
	var grid = jQuery("#listRoles").jqGrid(
			{

				// datatype : "local",
				// data:mydata,
				url : '/listarRolProyecto/',
				datatype : "json",
				mtype : "get",
				
				postData: { idFase : '0'},
				show : {
					effect : 'fade',
					duration : 200
				},
				
				hide : {
					effect : 'fade',
					duration : 200
				},
				colNames : [ 'ID rol ', 'Nombre',
						'Descripcion', 'Estado','listaPermisos' ],
				colModel : [ {
					name : 'idRol',
					index : 'idRol',
					hidden : true
				}, {
					name : 'nombre',
					index : 'nombre',
				}, {
					name : 'descripcion',
					index : 'descripcion',
					width: '250'
				}							
				, 
				{
					name : 'estado',
					index : 'estado',
					align : "center",
					
					formatter : 'select',
					stype : 'select',
					
					editoptions : {
						value : "todos:Todos;activo:Activo;inactivo:Inactivo"
					}
				},
				{
					name : 'listaPermisos',
					index : 'listaPermisos',
					hidden : true
				}

				],
				sortname : 'nombre',
				viewrecords : true,
				rownumbers : true,
				sortorder : "desc",
				ignoreCase : true,
				pager : '#pagerRoles',
				caption : "Lista de Roles",
				jsonReader : {
					root : "invdata",
					page : "currpage",
					total : "totalpages",
					records : "totalrecords",
					repeatitems : false,
					id : "idUsuario"
				}

			}).jqGrid('navGrid', '#pagerRoles', {
		edit : false,
		add : false,
		del : false,
		search : false,
		refresh : true
	});
	grid.jqGrid('filterToolbar', {
		stringResult : true,
		searchOnEnter : false,
		defaultSearch : "cn"
	});

	
	
	$('#comboFase');
	
	$("#dialogo-roles")
	.dialog(
			{
				autoOpen : false,
				width : 'auto',
				heigth: 'auto',
				overflow : scroll,
				modal : true,
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				resizable : false,
				buttons : {
					/* funcion asociado al boton aceptar */
					"Nuevo" : function(){agregarRol()},
					"Modificar" : function(){modificarRol()},
					"Consultar" : function(){consultarRol()},
					"Administrar Permisos" : function(){abrirDialogoPermisos()},
					"Activar/Inactivar": function(){activarInactivarRol()},
				}
	});
		
	var gridFase = jQuery("#listaFases")
	.jqGrid(
			{

				// datatype : "local",
				// data:mydata,
				url : '/listarFases/',
				datatype : "json",
				mtype : "get",
				postData:{idProyectoPD: '0'},
				colNames : [ 'ID Fases',
						'Nombre Fase', 'Fecha Inicio', 'Fecha Finalizacion',
						'Descripcion', 'Estado', 'Id de Proyecto' ],
				colModel : [
						{
							name : 'idFase',
							index : 'idFase',
							hidden : true
						},
						
						{
							name : 'nombreFase',
							index : 'nombreFase',
							width : 200
						},
						{
							name : 'fechaInicio',
							index : 'fechaInicio',
							formatter: 'date',
				            sorttype: 'date',
				            datefmt: 'd/m/Y',
				            formatoptions: { srcformat: 'Y-m-d', newformat: 'd/m/Y' },
							search:false
						},{
							name : 'fechaFinalizacion',
							index : 'fechaFinalizacion',
							formatter: 'date',
				            sorttype: 'date',
				            datefmt: 'd/m/Y',
				            formatoptions: { srcformat: 'Y-m-d', newformat: 'd/m/Y' },
							search:false
						},
						{
							name : 'descripcion',
							index : 'descripcion',
							hidden : true
						},
						{
							name : 'estado',
							index : 'estado',
							
						},
						{
							name : 'idProyecto',
							index : 'idProyecto',
							hidden : true
						}

				],
				sortname : 'nombreFase',
				viewrecords : true,
				rownumbers : true,
				sortorder : "desc",
				ignoreCase : true,
				pager : '#pagerFases',
				caption : "Fases",
				jsonReader : {
					root : "invdata",
					page : "currpage",
					total : "totalpages",
					records : "totalrecords",
					
					repeatitems : false,
					id : "idUsuario"
				}

			}).jqGrid('navGrid', '#pagerFases', {
		edit : false,
		add : false,
		del : false,
		search : false,
		refresh : true
	});
	gridFase.jqGrid('filterToolbar', {
	stringResult : true,
	searchOnEnter : false,
	defaultSearch : "cn"
	});

	
	$("#dialogo-fases")
	.dialog(
			{
				autoOpen : false,
				width : 'auto',
				height : 'auto',
				close: function() {
					$('#list').trigger("reloadGrid");
				   },
				overflow : scroll,
				modal : true,
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				resizable : false,
				buttons : {
					/* funcion asociado al boton aceptar */
					"Nueva" : function(){agregarFase()},
					"Modificar" : function(){modificarFase()},
					"Consultar" : function(){consultarFase()},
					"Consultar Items" : function(){consultarItems()}
				}
	});
	var banderaFase;
	$("#dialogo-datos-fase")
	.dialog(
			{
				autoOpen : false,
				modal : true,
				resizable : false,
				width : 550,
				show: {effect: 'fade', duration: 400},
				hide: {effect: 'fade', duration: 350},
				buttons : {
					/* funcion asociado al boton aceptar */
					"Aceptar" : function() {
						/* si el dato es nuevo se llamar a la url para agregar */
						
						if (getBanderaFase() == 1) {
							/* se indica la URL */
							if (controlFase(true) == 1) {
								mostrarMensaje("Error",
										"Campos completados incorrectamente");
							} else {
								
								$.post('/agregarFase/',{ 
									/* se indican los parametros*/
										nombreFase : $(
												"#nombreFase")
												.val(),
										fechaInicio : $(
												"#datepickerFase")
												.val(),
										fechaFinal : $(
												"#datepickerFase2")
												.val(),
										descripcion: $("#descripcionFase")
												.val(),
										estado : $("#estadoFase")
												.val(),
										
										idProyecto :valorProyectoSeleccion()
												},
												function(data, status) {
													/* funcion que maneja el resultruc : $("#ruc").val(),ado de la invocación */

													/* si hay error se muestra el mensaje*/
													if (data.substring(
															0, 1) == 't') {
														mostrarMensaje(
																"Error",
																"Los datos no se han podido guardar:\n"
																		+ data
																				.substring(2));
														/* se indica que no hubieron errores */
													} else {
														$(
																"#dialogo-datos-fase")
																.dialog(
																		"close");
														mostrarMensaje(
																"Exito",
																data
																		.substring(2));
														
													}
													/* se indicar la recarga de la tabla */
													$('#listaFases')
															.trigger(
																	"reloadGrid");
												});
							}

							/* si el dato se modifica se llama a la url para modificar*/
						} else if (getBanderaFase() == 2) {
							if (controlFase(false) == 1) {
								mostrarMensaje("Error",
										"Campos completados incorrectamente");
							} else {

								/* se indica la url */
								$
										.post(
												'/modificarFase/',
												{
											idFase:$(
													"#idFase")
													.val(),
											nombreFase : $(
													"#nombreFase")
													.val(),
											fechaInicio : $(
													"#datepickerFase")
													.val(),
											fechaFinal : $(
													"#datepickerFase2")
													.val(),
											descripcion: $("#descripcionFase")
													.val(),
											estado : $("#estadoFase")
													.val(),
											idProyecto :valorProyectoSeleccion()
												},
												function(data, status) {

													if (data.substring(
															0, 1) == 't') {
														mostrarMensaje(
																"Error",
																"Los datos no se han podido modificar:\n"
																		+ data
																				.substring(2));
													} else {
														$(
																"#dialogo-datos-fase")
																.dialog(
																		"close");
														mostrarMensaje(
																"Exito",
																"Los datos han sido modificados");
													}
													$('#listaFases')
															.trigger(
																	"reloadGrid");
												});
							}
						} else if (getBanderaFase() == 3) {/*consultar*/
							$(this).dialog("close");
						}
					},
					"Cancelar" : function() {
						$(this).dialog("close");
					}
				}
			});

	
	
	var gridProyecto = jQuery("#list")
			.jqGrid(
					{
						// datatype : "local",
						// data:mydata,
						url : '/listarProyectos/',
						datatype : "json",
						mtype : "get",
						colNames : [ 'ID Proyecto',
								'Nombre de Proyecto',
								'Fecha de Inicio',
								'ID ProjectLeader',
								'Nombre ProjectLeader',
								'Fecha de finalizacion',
								'Observacion',
								'Numero Fases',
								'Presupuesto', 'Estado' ],
						colModel : [
								{
									name : 'idProyecto',
									index : 'idProyecto',
	
									hidden : true
								},
								{
									name : 'nombreProyecto',
									index : 'nombreProyecto',
	
								},
								{
									name : 'fechaInicio',
									index : 'fechaInicio',
	
									formatter : 'date',
									sorttype : 'date',
									datefmt : 'd/m/Y',
									formatoptions : {
										srcformat : 'Y-m-d',
										newformat : 'd/m/Y'
									},
									search : false
								},
								{
									name : 'idProjectLeader',
									index : 'idProjectLeader',
	
									hidden : true
								},
								{
									name : 'nombreProjectLeader',
									index : 'nombreProjectLeader',
	
									hidden : true
								},
								{
									name : 'fechaFinalizacion',
									index : 'fechaFinalizacion',
	
									formatter : 'date',
									sorttype : 'date',
									datefmt : 'd/m/Y',
									formatoptions : {
										srcformat : 'Y-m-d',
										newformat : 'd/m/Y'
									},
									search : false
								},
								{
									name : 'observacion',
									index : 'observacion',
	
									hidden : true
								},
								{
									name : 'nroFases',
									index : 'nroFases',
	
									hidden : true
								},
								{
									name : 'presupuesto',
									index : 'presupuesto',
	
									search : false
								},
								{
									name : 'estado',
									index : 'estado',
									formatter : 'select',
									stype : 'select',
									editoptions : {
										value : "desarrollo:Desarrollo;activo:Activo;finalizado:Finalizado"
									},
									hidden : false
	
								}
	
						],
						sortname : 'nombreProyecto',
						viewrecords : true,
						rownumbers : true,
						sortorder : "desc",
						ignoreCase : true,
						pager : '#pager',
						caption : "Proyectos",
						jsonReader : {
							root : "invdata",
							page : "currpage",
							total : "totalpages",
							records : "totalrecords",
							repeatitems : false,
							id : "idProyecto"
						}
	
					}).jqGrid('navGrid', '#pager', {
				edit : false,
				add : false,
				del : false,
				search : false,
				refresh : false
			});
	gridProyecto.jqGrid('filterToolbar', {
		stringResult : true,
		searchOnEnter : false,
		defaultSearch : "cn"
	});
	
	$("#dialogo-proyecto")
			.dialog(
					{
						autoOpen : false,
						width : 'auto',
						height : '500',
						overflow : scroll,
						modal : true,
						show : {
							effect : 'fade',
							duration : 400
						},
						hide : {
							effect : 'fade',
							duration : 350
						},
						resizable : false,
						buttons : {
							/* funcion asociado al boton aceptar */
							"Aceptar" : function() {
								/* si el dato es nuevo se llamar a la url para agregar */
								if (bandera == 1) { /*si bandera==1 entonces es nuevo proyecto*/
									/* se indica la URL */
									if (control() == 1) {
										mostrarMensaje(
												"Error",
												"Campos completados incorrectamente");
									} else {
										$
												.post(
														'/agregarProyecto/',
														{ /* se indican los parametros*/
															nombreProyecto : $(
																	"#nombreProyecto")
																	.val(),
															fechaInicio : $(
																	"#datepicker")
																	.val(),
															fechaFinal : $(
																	"#datepicker2")
																	.val(),
															presupuesto : $(
																	"#presupuesto")
																	.val(),
															observacion : $(
																	"#observacion")
																	.val(),
															idProjectLeader : $(
																	"#idProjectLeader")
																	.val(),
															estado : $(
																	"#estado")
																	.val()
	
														},
														function(
																data,
																status) {
															/* funcion que maneja el resultruc : $("#ruc").val(),ado de la invocación */
	
															/* si hay error se muestra el mensaje*/
															if (data
																	.substring(
																			0,
																			1) == 't') {
																mostrarMensaje(
																		"Error",
																		"Los datos no se han podido guardar:\n"
																				+ data
																						.substring(2));
																/* se indica que no hubieron errores */
															} else {
																$(
																		"#dialogo-proyecto")
																		.dialog(
																				"close");
																mostrarMensaje(
																		"Exito",
																		data
																				.substring(2));
															}
															/* se indicar la recarga de la tabla */
															$(
																	'#list')
																	.trigger(
																			"reloadGrid");
														});
									}
	
									/* si el dato se modifica se llama a la url para modificar*/
								} else if (bandera == 2) {
									if (control() == 1) {
										mostrarMensaje(
												"Error",
												"Campos completados incorrectamente");
									} else {
										/* se indica la url */
										$
												.post(
														'/modificarProyecto',
														{
															idProyecto : $(
																	"#idProyecto")
																	.val(),
															nombreProyecto : $(
																	"#nombreProyecto")
																	.val(),
															fechaInicio : $(
																	"#datepicker")
																	.val(),
															fechaFinalizacion : $(
																	"#datepicker2")
																	.val(),
															presupuesto : $(
																	"#presupuesto")
																	.val(),
															activo : $(
																	"#activo")
																	.val(),
															observacion : $(
																	"#observacion")
																	.val(),
															idProjectLeader : $(
																	"#idProjectLeader")
																	.val(),
															estado : $(
																	"#estado")
																	.val()
	
														},
														function(
																data,
																status) {
	
															if (data
																	.substring(
																			0,
																			1) == 't') {
																mostrarMensaje(
																		"Error",
																		"Los datos no se han podido modificar:\n"
																				+ data
																						.substring(2));
															} else {
																$(
																		"#dialogo-proyecto")
																		.dialog(
																				"close");
																mostrarMensaje(
																		"Exito",
																		"Los datos han sido modificados");
															}
															$(
																	'#list')
																	.trigger(
																			"reloadGrid");
														});
									}
								} else if (bandera == 3) {
									$(this).dialog("close");
								}
							},
							"Cancelar" : function() {
								$(this).dialog("close");
							}
						}
});
//#################################################################################### 
	var gridComite = jQuery("#listComite")
	.jqGrid(
			{

				url : '/listarMiembrosComite/',
				datatype : "json",
				mtype : "get",
				postData : {
					idProyecto : '2'
				},
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				colNames : [ 'ID Usuario ',
						'Cedula',
						'Nombre de Usuario',
						'Nombre', 'Apellido',
						'Password', 'Email',
						'Direccion', 'Telefono',
						'Observacion',
						'Es del Comite' ],
				colModel : [
						{
							name : 'idUsuario',
							index : 'idUsuario',
							width : 200,
							hidden : true
						},
						{
							name : 'ci',
							index : 'ci',
							width : 200,
							hidden : true
						},
						{
							name : 'nombreUsuario',
							index : 'nombreUsuario',
							width : 200
						},
						{
							name : 'nombre',
							index : 'nombre',
							width : 180
						},
						{
							name : 'apellido',
							index : 'apellido',
							width : 180
						},
						{
							name : 'pass',
							index : 'pass',
							width : 200,
							hidden : true
						},
						{
							name : 'email',
							index : 'email',
							width : 180
						},
						{
							name : 'direccion',
							index : 'direccion',
							width : 200,
							hidden : true
						},
						{
							name : 'telefono',
							index : 'telefono',
							width : 200,
							hidden : true
						},
						{
							name : 'observacion',
							index : 'observacion',
							width : 200,
							hidden : true
						},
						{
							name : 'enComite',
							index : 'enComite',
							width : 90,
							align : "center",
							formatter : 'select',
							stype : 'select',

							editoptions : {
								value : "todos:Todos;si:Si;no:No"
							},
						}

				],
				sortname : 'nombreUsuario',
				viewrecords : true,
				rownumbers : true,
				sortorder : "desc",
				ignoreCase : true,
				pager : '#pagerComite',
				caption : "Usuarios miembros del Proyecto",
				jsonReader : {
					root : "invdata",
					page : "currpage",
					total : "totalpages",
					records : "totalrecords",
					repeatitems : false,
					id : "idUsuario"
				}

			}).jqGrid('navGrid', '#pagerComite',
			{
				edit : false,
				add : false,
				del : false,
				search : false,
				refresh : false
			});
gridComite.jqGrid('filterToolbar', {
stringResult : true,
searchOnEnter : false,
defaultSearch : "cn"
});

$('#dialogo-agregar-miembros-comite')
	.dialog(
			{
				autoOpen : false,
				width : 'auto',
				heigth: 'auto',
				modal : true,
				resizable : true,
				show : {
					effect : 'fade',
					duration : 400
				},
				hide : {
					effect : 'fade',
					duration : 350
				},
				buttons : {
					/* funcion asociado al boton aceptar */
					"Agregar" : function() {
						
						var row = $('#list').jqGrid('getGridParam', 'selrow');
						if (row == null) {
							mostrarMensaje("Atencion", "Seleccione la fila a modificar");
							return;
						}
						
						var rowdata = $('#list').getRowData(row);
						
						if (rowdata.estado=="finalizado"){
							mostrarMensaje("Atencion", "El proyecto ya no puede ser modificado");
							return 
						}
						
						/* se pregunta si es que se selecciono la fila en proyectos, y en lel grid de users */
						var rowComite = $(
								'#listComite')
								.jqGrid(
										'getGridParam',
										'selrow');

						if (rowComite == null) {
							mostrarMensaje(
									"Atencion",
									"Seleccione el Usuario a agregar");
							return;
						}
						var rowProyecto = $('#list')
						.jqGrid(
								'getGridParam',
								'selrow');
						
						if (rowProyecto == null) {
							mostrarMensaje(
									"Atencion",
									"Seleccione el proyecto");
							return;
						}

						var rowdata = $('#list')
								.getRowData(
										rowProyecto);
						var rowdataComite = $(
								'#listComite')
								.getRowData(
										rowComite);

						/* se indica la URL */
						$.post(
										'/agregarMiembrosComite/',
										{ /* se indican los parametros*/
											idProyecto : rowdata.idProyecto,
											idUsuario : rowdataComite.idUsuario

										},
										function(
												data,
												status) {
											/* funcion que maneja el resultruc : $("#ruc").val(),ado de la invocación */

											/* si hay error se muestra el mensaje*/
											if (data
													.substring(
															0,
															1) == 't') {
												mostrarMensaje(
														"Error",
														"Los datos no se han podido guardar:\n"
																+ data
																		.substring(2));
												/* se indica que no hubieron errores */
											} else {
												mostrarMensaje(
														"Exito",
														data
																.substring(2));
											}
											/* se indicar la recarga de la tabla */
											$(
													'#listComite')
													.trigger(
															"reloadGrid");
										});

						/* si el dato se modifica se llama a la url para modificar*/
					},
					"Quitar" : function() {
						
						
						var row = $('#list').jqGrid('getGridParam', 'selrow');
						if (row == null) {
							mostrarMensaje("Atencion", "Seleccione la fila a modificar");
							return;
						}
						
						var rowdata = $('#list').getRowData(row);
						
						if (rowdata.estado=="finalizado"){
							mostrarMensaje("Atencion", "El proyecto ya no puede ser modificado");
							return 
						}
						
						
						
						
						var rowComite = $(
								'#listComite')
								.jqGrid(
										'getGridParam',
										'selrow');
						if (rowComite == null) {
							mostrarMensaje(
									"Atencion",
									"Seleccione el Usuario a agregar");
							return;
						}
						var rowProyecto = $('#list')
								.jqGrid(
										'getGridParam',
										'selrow');
						if (rowProyecto == null) {
							mostrarMensaje(
									"Atencion",
									"Seleccione el proyecyo");
							return;
						}

						var rowdata = $('#list')
								.getRowData(
										rowProyecto);
						var rowdataComite = $(
								'#listComite')
								.getRowData(
										rowComite);
						/* se indica la url */
						$.post('/quitarMiembrosComite',
										{
											idUsuario : rowdataComite.idUsuario,				
											idProyecto : rowdata.idProyecto
											
										},
										function(data,status) {

											if (data.substring(0,1) == 't') {
												mostrarMensaje(
														"Error",
														"Usuario no se ha podido quitar:\n"
																+ data.substring(2));
											} else {
												mostrarMensaje(
														"Exito",
														"Usuario ha sido quitado del proyecto");
											}
											$('#listComite').trigger("reloadGrid");
										});
					},
					"Salir" : function() {
						$(this).dialog("close");
					}
				}
			});


//############################################################################################################3 
	
var gridMiembros = jQuery("#listMiembros")
		.jqGrid(
				{

					url : '/listarMiembrosProyecto/',
					datatype : "json",
					mtype : "get",
					postData : {
						idProyecto : '2'
					},
					show : {
						effect : 'fade',
						duration : 400
					},
					hide : {
						effect : 'fade',
						duration : 350
					},
					colNames : [ 'ID Usuario ',
							'Cedula',
							'Nombre de Usuario',
							'Nombre', 'Apellido',
							'Password', 'Email',
							'Direccion', 'Telefono',
							'Observacion',
							'Es Miembro', 'Estado' ],
					colModel : [
							{
								name : 'idUsuario',
								index : 'idUsuario',
								width : 200,
								hidden : true
							},
							{
								name : 'ci',
								index : 'ci',
								width : 200,
								hidden : true
							},
							{
								name : 'nombreUsuario',
								index : 'nombreUsuario',
								width : 200
							},
							{
								name : 'nombre',
								index : 'nombre',
								width : 180
							},
							{
								name : 'apellido',
								index : 'apellido',
								width : 180
							},
							{
								name : 'pass',
								index : 'pass',
								width : 200,
								hidden : true
							},
							{
								name : 'email',
								index : 'email',
								width : 180
							},
							{
								name : 'direccion',
								index : 'direccion',
								width : 200,
								hidden : true
							},
							{
								name : 'telefono',
								index : 'telefono',
								width : 200,
								hidden : true
							},
							{
								name : 'observacion',
								index : 'observacion',
								width : 200,
								hidden : true
							},
							{
								name : 'enProyecto',
								index : 'enProyecto',
								width : 90,
								align : "center",
								formatter : 'select',
								stype : 'select',

								editoptions : {
									value : "Todos:Todos;Si:Si;No:No"
								},
							},
							{
								name : 'activo',
								index : 'activo',
								formatter : 'select',
								stype : 'select',
								editoptions : {
									value : "true:Activo;false:Inactivo"
								},
								hidden : true
							}

					],
					sortname : 'nombreUsuario',
					viewrecords : true,
					rownumbers : true,
					sortorder : "desc",
					ignoreCase : true,
					pager : '#pagerMiembros',
					caption : "Lista de Usuarios",
					jsonReader : {
						root : "invdata",
						page : "currpage",
						total : "totalpages",
						records : "totalrecords",
						repeatitems : false,
						id : "idUsuario"
					}

				}).jqGrid('navGrid', '#pagerMiembros',
				{
					edit : false,
					add : false,
					del : false,
					search : false,
					refresh : false
				});
gridMiembros.jqGrid('filterToolbar', {
	stringResult : true,
	searchOnEnter : false,
	defaultSearch : "cn"
});

$('#dialogo-agregar-miembros')
		.dialog(
				{
					autoOpen : false,
					width : 'auto',
					heigth: 'auto',
					modal : true,
					resizable : true,
					show : {
						effect : 'fade',
						duration : 400
					},
					hide : {
						effect : 'fade',
						duration : 350
					},
					buttons : {
						/* funcion asociado al boton aceptar */
						"Agregar" : function() {
							/* se pregunta si es que se selecciono la fila en proyectos, y en lel grid de users */
							var rowMiembros = $(
									'#listMiembros')
									.jqGrid(
											'getGridParam',
											'selrow');

							if (rowMiembros == null) {
								mostrarMensaje(
										"Atencion",
										"Seleccione el Usuario a agregar");
								return;
							}
							var rowProyecto = $('#list')
							.jqGrid(
									'getGridParam',
									'selrow');
							
							if (rowProyecto == null) {
								mostrarMensaje(
										"Atencion",
										"Seleccione el proyecto");
								return;
							}

							var rowdata = $('#list')
									.getRowData(
											rowProyecto);
							var rowdataMiembros = $(
									'#listMiembros')
									.getRowData(
											rowMiembros);

							if (rowdataMiembros.activo == 'false') {
								mostrarMensaje(
										"Atencion",
										"No se puede agregar usuario inactivo a un proyecto");
							}
							/* se indica la URL */
							$
									.post(
											'/agregarMiembrosProyecto/',
											{ /* se indican los parametros*/
												idProyecto : rowdata.idProyecto,
												idUsuarioAgregar : rowdataMiembros.idUsuario

											},
											function(
													data,
													status) {
												/* funcion que maneja el resultruc : $("#ruc").val(),ado de la invocación */

												/* si hay error se muestra el mensaje*/
												if (data
														.substring(
																0,
																1) == 't') {
													mostrarMensaje(
															"Error",
															"Los datos no se han podido guardar:\n"
																	+ data
																			.substring(2));
													/* se indica que no hubieron errores */
												} else {
													mostrarMensaje(
															"Exito",
															data
																	.substring(2));
												}
												/* se indicar la recarga de la tabla */
												$(
														'#listMiembros')
														.trigger(
																"reloadGrid");
											});

							/* si el dato se modifica se llama a la url para modificar*/
						},
						"Quitar" : function() {
							var rowMiembros = $(
									'#listMiembros')
									.jqGrid(
											'getGridParam',
											'selrow');
							if (rowMiembros == null) {
								mostrarMensaje(
										"Atencion",
										"Seleccione el Usuario a agregar");
								return;
							}
							var rowProyecto = $('#list')
									.jqGrid(
											'getGridParam',
											'selrow');
							if (rowProyecto == null) {
								mostrarMensaje(
										"Atencion",
										"Seleccione el proyecyo");
								return;
							}

							var rowdata = $('#list')
									.getRowData(
											rowProyecto);
							var rowdataMiembros = $(
									'#listMiembros')
									.getRowData(
											rowMiembros);
							/* se indica la url */
							$
									.post(
											'/QuitarMiembrosProyecto',
											{
												idProyecto : rowdata.idProyecto,
												idUsuario : rowdataMiembros.idUsuario
											},
											function(
													data,
													status) {

												if (data
														.substring(
																0,
																1) == 't') {
													mostrarMensaje(
															"Error",
															"Usuario no se ha podido quitar:\n"
																	+ data
																			.substring(2));
												} else {
													mostrarMensaje(
															"Exito",
															"Usuario ha sido quitado del proyecto");
												}
												$(
														'#listMiembros')
														.trigger(
																"reloadGrid");
											});
						},
						"Salir" : function() {
							$(this).dialog("close");
						}
					}
				});

	});
</script>

<script type="text/javascript">
	jQuery(function($) {
		$.datepicker.regional['es'] = {
			closeText : 'Cerrar',
			prevText : '&#x3c;Ant',
			nextText : 'Sig&#x3e;',
			currentText : 'Hoy',
			monthNames : [ 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo',
					'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre',
					'Noviembre', 'Diciembre' ],
			monthNamesShort : [ 'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun',
					'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic' ],
			dayNames : [ 'Domingo', 'Lunes', 'Martes', 'Mi&eacute;rcoles',
					'Jueves', 'Viernes', 'S&aacute;bado' ],
			dayNamesShort : [ 'Dom', 'Lun', 'Mar', 'Mi&eacute;', 'Juv', 'Vie',
					'S&aacute;b' ],
			dayNamesMin : [ 'Do', 'Lu', 'Ma', 'Mi', 'Ju', 'Vi', 'S&aacute;' ],
			weekHeader : 'Sm',
			dateFormat : 'dd/mm/yy',
			firstDay : 1,
			isRTL : false,
			showMonthAfterYear : false,
			yearSuffix : ''
		};
		$.datepicker.setDefaults($.datepicker.regional['es']);
	});

	$(document).ready(function() {
		$("#datepicker").datepicker();
	});

	$(document).ready(function() {
		$("#datepicker2").datepicker();
	});
	$(document).ready(function() {
		$("#datepickerFase").datepicker();
	});
	
	$(document).ready(function() {
		$("#datepickerFase2").datepicker();
	});
</script>

<!-- Formulario HTML para la carga de datos a ser inicializado por JqGrid -->
<style type="text/css">
.fieldset {
	width: auto;
	border: 0;
}
</style>
<div id="dialogo-proyecto" title="Datos de Proyecto">
	<form>
		<fieldset class="fieldset">
			<table style="float: left">
				<tr>
					<td><input type="hidden" name="idProyecto" id="idProyecto" />
						<label for="nombreProyecto" style="display: block">*Nombre
							Proyecto</label><input type="text" name="nombreProyecto"
						id="nombreProyecto"
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" />
						<input type="hidden" name="idProjectLeader" id="idProjectLeader" />
					</td>
					<td><br></br> <input type="text" readonly tabIndex="-1"
						name="EnombreProyecto" id="EnombreProyecto"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>

				<tr>
					<td><label for="nombreProjectLeader" style="display: block">*Nombre
							de ProjectLeader</label> <input type="text" name="nombreProjectLeader"
						id="nombreProjectLeader"
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" />

					</td>
					<td><br></br> <input type="text" readonly tabIndex="-1"
						name="EnombreProjectLeader" id="EnombreProjectLeader"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>
				<tr>
					<td><label for="fechaInicio" style="display: block">Fecha
							de Inicio</label> <input type="text" name="datepicker" id="datepicker"
						readonly="readonly"
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
					<td><br></br> <input type="text" readonly tabIndex="-1"
						name="Edatepicker" id="Edatepicker"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>
				<tr>
					<td><label for="fechaFinalizacion" style="display: block">Fecha
							de Finalizacion</label> <input type="text" name="datepicker2"
						id="datepicker2" readonly="readonly"
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
					<td><br></br> <input type="text" readonly tabIndex="-1"
						name="Edatepicker2" id="Edatepicker2"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>

				</tr>
				<tr>
					<td><label for="presupuesto" style="display: block">Presupuesto</label>
						<input type="text" name="presupuesto" id="presupuesto" value=""
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
					<td><br></br> <input type="text" readonly tabIndex="-1"
						name="Epresupuesto" id="Epresupuesto"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>
				<tr>
					<td><label for="observacion" style="display: block">Observacion</label>
						<textarea type="text" name="observacion" id="observacion" value=""
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" ></textarea>
					</td>
					<td><br></br> <input type="text" readonly tabIndex="-1"
						name="Eobservacion" id="Eobservacion"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>
				<tr>
					<td><label id="lNroFases" for="nroFases"  style="display: block">
					</label> <input type="text" name="nroFases" id="nroFases"
						value=""
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
					<td><br></br> <input type="text" readonly tabIndex="-1"
						name="EnroFases" id="EnroFases"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>
				
				<tr>
					<td><label id="lEstado" for="estado" style="display: block"></label>
						<select id="estado"
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em; width: 50%;">
							<option value="desarrollo">Desarrollo</option>
							<option value="activo">Activo</option>
					</select></td>
				</tr>
			</table>
			<table style="float: left">

			</table>
		</fieldset>
	</form>
</div>
{% endblock %} {% block body %}

<script>

function cargaComboUsuario(){
	if (valorProyectoSeleccion()!=0){
		$.post('/listarComboUsuario/',
				{ /* se indican los parametros*/
					idProyecto : valorProyectoSeleccion()
				},
				function(data, status) {
					var select = $('#comboUsuario');
					var options = select.prop('options');
					
					$('option', select).remove();
					options[0] = new Option("--Seleccione un Usuario--","0");
					var index=0
					
					data = $.parseJSON( data );
					//var jsonData = JSON.stringify(eval("(" + data + ")"));
					$.each(data, function(index,usuario) {
						index=index+1;
						options[options.length] = new Option(index+" : "+usuario.nombreUsuario,usuario.idUsuario);
					})
				}
			);
		$('#listRolUser').clearGridData(true);
		$('#dialogo-rolUsuario').dialog("open");
	}else{
		mostrarMensaje("Atencion","Debe seleccionar un Proyecto")
		
	}
	
}

function comboUsuarioSeleccion()
{
	return $('#comboUsuario').val()
	
}

function reloadGridRolProyecto(){
	
	$("#comboUsuario option[value='0']").remove();
	var myPostData = $('#listRolUser').jqGrid("getGridParam", "postData");
	delete myPostData.idProyecto;
	delete myPostData.idUsuario;
	//eso borra el idFase actual
	$('#listRolUser').setGridParam({
	postData: { idProyecto: valorProyectoSeleccion(), idUsuario: comboUsuarioSeleccion() } });
	//eso se setea el nuevo valor
	$('#listRolUser').trigger("reloadGrid");

	
}

function agregarRolUser (){
	/* se pregunta si es que se selecciono la fila en proyectos, y en lel grid de users */
	var rowRol = $('#listRolUser').jqGrid(
			'getGridParam', 'selrow');
	if (rowRol == null) {
		mostrarMensaje("Atencion",
				"Seleccione el Rol a agregar");
		return;
	}
	var rowdataRoles = $('#listRolUser')
			.getRowData(rowRol);

	if (rowdataRoles.enUsuario == 'Si') {
		mostrarMensaje("Atencion",
				"No se puede asignar el Rol. Ya se encuentra asignado");
	}
	/* se indica la URL */
	$
			.post(
					'/agregarRolUsuario/',
					{ /* se indican los parametros*/
						idRol : rowdataRoles.idRol,
						idUsuario : $('#comboUsuario').val()

					},
					function(data, status) {
						/* funcion que maneja el resultruc : $("#ruc").val(),ado de la invocación */

						/* si hay error se muestra el mensaje*/
						if (data.substring(0, 1) == 't') {
							mostrarMensaje(
									"Error",
									"Los datos no se han podido guardar:\n"
											+ data
													.substring(2));
							/* se indica que no hubieron errores */
						} else {
							mostrarMensaje(
									"Exito",
									data
											.substring(2));
						}
						/* se indicar la recarga de la tabla */
						$('#listRolUser').trigger(
								"reloadGrid");
					});
	
	
}

function quitarRolUser (){
	/* se pregunta si es que se selecciono la fila en proyectos, y en lel grid de users */
	var rowRol = $('#listRolUser').jqGrid(
			'getGridParam', 'selrow');
	if (rowRol == null) {
		mostrarMensaje("Atencion",
				"Seleccione el Rol a agregar");
		return;
	}
	var rowdataRoles = $('#listRolUser')
			.getRowData(rowRol);

	if (rowdataRoles.enUsuario == 'No') {
		mostrarMensaje("Atencion",
				"El rol no pertenece al Usuario");
	}
	/* se indica la URL */
	$
			.post(
					'/quitarRolUsuario/',
					{ /* se indican los parametros*/
						idRol : rowdataRoles.idRol,
						idUsuario : $('#comboUsuario').val()

					},
					function(data, status) {
						/* funcion que maneja el resultruc : $("#ruc").val(),ado de la invocación */

						/* si hay error se muestra el mensaje*/
						if (data.substring(0, 1) == 't') {
							mostrarMensaje(
									"Error",
									"Los datos no se han podido guardar:\n"
											+ data
													.substring(2));
							/* se indica que no hubieron errores */
						} else {
							mostrarMensaje(
									"Exito",
									data
											.substring(2));
						}
						/* se indicar la recarga de la tabla */
						$('#listRolUser').trigger(
								"reloadGrid");
					});
	
}



var banderaRol;
	function abrirDialogoPermisos() {
	
		var rowRol = $('#listRoles').jqGrid('getGridParam', 'selrow');
		if (rowRol == null) {
			mostrarMensaje("Atencion",
					"Seleccione el Rol a cual administrar permisos ");
			return;
		}
		var rowdata = $('#listRoles').getRowData(rowRol);
		
		$('#listPermisos').jqGrid("getGridParam", "postData").idRol=rowdata.idRol;
		$('#listPermisos').trigger("reloadGrid");
		$('#dialogo-permisos').dialog("open");
	}

	/*lo necesario para el dialogo de roles*/
	function cargarFormRol(rowdata, row) {
		rowdata = $('#listRoles').getRowData(row);
		$("#idRol").val(rowdata.idRol);
		$("#nombreRol").val(rowdata.nombre);
		$("#descripcionRol").val(rowdata.descripcion);
		
		}

	function setCamposDisabledRol(habilitar) {
		$("#nombreRol").attr('disabled', habilitar);
		$("#descripcionRol").attr('disabled', habilitar);
	}

	function setBordeNormalRol() {
		$("#nombreRol").css('border-color', 'skyblue');
		$("#descripcionRol").css('border-color', 'skyblue');
	}
	
	function setCampoErroresRol(){
		$("#EnombreRol").val("");
		$("#EdescripcionRol").val("");
	}
	
	function controlRol(esNuevo) {
		setCampoErroresRol();
		setBordeNormalRol();
		var error = 0;
		var len;

		len = $("#nombreRol").val().trim().length;
		if (len > 20 || len <= 0) {
			$("#nombreRol").css('border-color', 'red');
			$("#EnombreRol").val("Campo Obligario. Long. max 20").css('color', 'red');	
			error = 1;
		}


		len = $("#descripcionRol").val().trim().length;
		if (len > 50 || len <= 0) {
			$("#descripcionRol").css('border-color', 'red');
			$("#EdescripcionRol").val("Campo Obligario. Long. max 50").css('color', 'red');	
			error = 1;
		}		return error;
	}
	
	/* funcion para llamar al formulario agregar un nuevo datos */
	function agregarRol() {
		setBordeNormalRol();
		setCampoErroresRol();
		banderaRol = 1;

		/* se vacian los elementos HTML de captura de datos */
		$("#idRol").val("");
		$("#nombreRol").val("");
		$("#descripcionRol").val("");
		
		/* se llama al dialogo de captura de datos */
		setCamposDisabledRol(false);
		if($("#comboFase").val()==0){
			mostrarMensaje("Error", "Se debe seleccionar fase para agregar nuevo Rol")
		}else{
			$("#dialogo-rolProyecto").dialog("open");
		}
	}
	

	/* funcion para llamar al formulario para la modificación de datos */
	function modificarRol() {

		setBordeNormalRol();
		setCampoErroresRol();
		/* se indica que el dato no es nuevo */
		banderaRol = 2;
		/* se comprueba que hay un dato seleccionado para modificar */
		var row = $('#listRoles').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione la fila a modificar");
			return;
		}
		var rowdata;
		/* se cargan los elementos HTML segun la fila seleccionada*/
		cargarFormRol(rowdata, row);
		rowdata = $('#listRoles').getRowData(row);
		
		if (rowdata.estado == "activo")
		{
			mostrarMensaje("Atencion", "El rol no puede modificarse. Ya se encuentra Activo");
			return;
			
		}else{	
		/*se habilita la edicion*/
		setCamposDisabledRol(false);
		
		$("#dialogo-rolProyecto").dialog("open");
		}
	}

	function activarInactivarRol() {
		var row = $('#listRoles').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione un Rol");
			return;
		}
		var rowdata;
		rowdata = $('#listRoles').getRowData(row);
		
		$.post('/estadoRol/',{
			
			idRol: rowdata.idRol,
			estado: rowdata.estado,
			},
			function(data, status) {
				if (data.substring(0, 1) == 't') {
					mostrarMensaje(
							"Error","Los datos no se han podido guardar:\n"
									+ data.substring(2));
			
				} else {
					mostrarMensaje(
							"Exito",
							data
									.substring(2));
				}
			
				$('#listRoles')
						.trigger(
								"reloadGrid");
			});	
}
		
	
	
	function consultarRol() {
		setBordeNormalRol();
		setCampoErroresRol();

		//$('#idEstado').detach().attr('type', 'text').attr('disabled',true).insertAfter('#activo').val($('#activo').val());
		//cambia el comboBox por un campo disabled del estado 
		//$('#activo').hide();
		/* se indica que el dato no es nuevo */
		banderaRol = 3;
		/* se comprueba que hay un dato seleccionado para consultar */
		var row = $('#listRoles').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione la fila a consultar");
			return;
		}
		var rowdata;
		/* se cargan los elementos HTML segun la fila seleccionada*/
		cargarFormRol(rowdata, row);
		/*se inhabilita la edicion*/
		rowdata = $('#listRoles').getRowData(row);
		setCamposDisabledRol(true);
		/* se llama al dialogo para modificar los datos */
		$("#dialogo-rolProyecto").dialog("open");
	}

	
	/*se carga el combo de Fases*/
	function cargaComboFase(){
		
		if(valorProyectoSeleccion()!=0){
			$.post('/listarComboFases/',
					{ /* se indican los parametros*/
						idProyecto : valorProyectoSeleccion()
					},
					function(data, status) {
						var select = $('#comboFase');
						var options = select.prop('options');
						
						$('option', select).remove();
						options[0] = new Option("--Seleccione una Fase--","0");
						var index=0
						
						data = $.parseJSON( data );
						//var jsonData = JSON.stringify(eval("(" + data + ")"));
						$.each(data, function(index,fase) {
							index=index+1;
							options[options.length] = new Option(index+" : "+fase.nombreFase,fase.idFase);
						})
					}
				);
			reloadPostData();
			$('#listRoles').clearGridData(true);
			$('#dialogo-roles').dialog("open");
		}else{
			mostrarMensaje("Atencion","Debe seleccionar un Proyecto");
		}
	}	
	
	function comboFaseSeleccion()
	{
		return $('#comboFase').val()
		
	}
	function reloadPostData(){
		var myPostData = $('#listRoles').jqGrid("getGridParam", "postData");
		delete myPostData.idFase;
		//eso borra el idFase actual
		$('#listRoles').setGridParam({
		postData: { idFase: '0' } });
		//eso se setea el nuevo valor
		
	}
	
	function reloadGridRol(){
		
		$("#comboFase option[value='0']").remove();
		var myPostData = $('#listRoles').jqGrid("getGridParam", "postData");
		delete myPostData.idFase;
		//eso borra el idFase actual
		$('#listRoles').setGridParam({
		postData: { idFase: comboFaseSeleccion() } });
		//eso se setea el nuevo valor
		$('#listRoles').trigger("reloadGrid");
	
		
	}
	
	
	




	/* variable permite indicar si se está cargando un nuevo item de datos */
	var banderita;
	var yaentro;
	/* inicialización del dialogo JQuery que permite tomar los datos de cliente */
	function valorProyectoSeleccion(){
		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			return '0';
		}
		var rowdata = $('#list').getRowData(rowProyecto);
		return rowdata.idProyecto;
	}
	
	function abrirDialogoFases()
	{
		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			mostrarMensaje("Atencion",
					"Seleccione el proyecto a cual administrar Fases ");
			return;
		}
		var rowdata = $('#list').getRowData(rowProyecto);
		
		setGridFase(rowdata); 
		$('#dialogo-fases').dialog("open");
		
	}
	
	function setGridFase(rowdata) {
		
		$('#listaFases').jqGrid("getGridParam", "postData").idProyectoPD=rowdata.idProyecto;
		$('#listaFases').trigger("reloadGrid");
		
	}
	
	function getBanderaFase(){
		return banderaFase;
		
	}
	
	function agregarFase() {
		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			mostrarMensaje("Atencion",
					"Seleccione el proyecto a cual administrar Fases ");
			return;
		}
		var rowdata = $('#list').getRowData(rowProyecto);
		
		
		if (rowdata.estado!="desarrollo"){
			mostrarMensaje("Atencion","Ya no se pueden realizar cambios a las fases del proyecto");
			return;
		}
		
		banderaFase=1;
		$("#idFase").val("");
		$("#nombreFase").val("");
		$("#datepickerFase").val("");
		$("#datepickerFase2").val("");
		$("#descripcionFase").val("");
		$("#estadoFase").val("");
		$("#idProyectoFase").val("");
		/* se llama al dialogo de captura de datos */
		setCamposDisabledFase(false);
		$("#estadoFaseDiv").hide();
		//$.enmascarar();
		if(valorProyectoSeleccion()!=0){
			$("#dialogo-datos-fase").dialog("open");
		}else{
			mostrarMensaje("Error", "Debe seleccionar un proyecto para agregar una fase")
		}
		
	}
	function modificarFase() {
		
		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			mostrarMensaje("Atencion",
					"Seleccione el proyecto a cual administrar Fases ");
			return;
		}
		var rowdata = $('#list').getRowData(rowProyecto);
		
		if (rowdata.estado!="desarrollo"){
			mostrarMensaje("Atencion","Ya no se pueden realizar cambios a las fases del proyecto");
			return;
		}
		
		banderaFase=2;
		/* se comprueba que hay un dato seleccionado para modificar */
		var row = $('#listaFases').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione la fila a modificar");
			return;
		}
		var rowdata;
		/* se cargan los elementos HTML segun la fila seleccionada*/
		cargarFormFase(rowdata, row);
		$("#estadoFaseDiv").hide();
		/*se habilita la edicion*/
		setCamposDisabledFase(false);
		/* se llama al dialogo para modificar los datos */
		$("#dialogo-datos-fase").dialog("open");
		
	}
	
	function consultarItems() {
		
		var row = $('#listaFases').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione la fila a consultar");
			return;
		}
		var rowdata;
		rowdata = $('#listaFases').getRowData(row);
		
		$('#listaItems').setGridParam({
			postData: { idP : "{{session['idProyecto']}}",
				idF : rowdata.idFase  } });
			//eso se setea el nuevo valor
			$('#listaItems').trigger("reloadGrid");
			
			$("#dialogo-listaItems").dialog("open");
		
		
	}
	
	function consultarFase() {
		banderaFase=3;
		/* se comprueba que hay un dato seleccionado para consultar */
		var row = $('#listaFases').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione la fila a consultar");
			return;
		}
		var rowdata;
		/* se cargan los elementos HTML segun la fila seleccionada*/
		cargarFormFase(rowdata, row);
		$("#estadoFaseDiv").show();
		/*se inhabilita la edicion*/
		setCamposDisabledFase(true);
		/* se llama al dialogo para modificar los datos */
		$("#dialogo-datos-fase").dialog("open");
	
	}
	function controlFase(esNuevo) {
		$("#nombreFase").css('border-color', 'skyblue');
		$("#datepickerFase").css('border-color', 'skyblue');
		$("#datepickerFase2").css('border-color', 'skyblue');
		$("#descripcionFase").css('border-color', 'skyblue');
		$("#estadoFase").css('border-color', 'skyblue');
		
		var error = 0
		var len;

		len = $("#nombreFase").val().trim().length;
		if (len > 20 || len <= 0) {
			$("#nombreFase").css('border-color', 'red');
			error = 1;
		}

		len = document.getElementById("descripcionFase").value.trim().length;
		//len=$("#observacion").val().trim().length;
		if (len > 50 || len <= 0) {
			$("#descripcionFase").css('border-color', 'red');
			error = 1;
		}
		len = document.getElementById("datepickerFase").value.trim().length;
		//len=$("#observacion").val().trim().length;
		if (len <= 0) {
			$("#datepickerFase").css('border-color', 'red');
			error = 1;
		}
		
		len = document.getElementById("datepickerFase2").value.trim().length;
		//len=$("#observacion").val().trim().length;
		if (len <= 0) {
			$("#datepickerFase2").css('border-color', 'red');
			error = 1;
		}
		return error;
	}
	
	function setCamposDisabledFase(habilitar) {
		
		$("#idFase").attr('disabled', habilitar);
		$("#nombreFase").attr('disabled', habilitar);
		$("#datepickerFase").attr('disabled', habilitar);
		$("#datepickerFase2").attr('disabled', habilitar);
		$("#descripcionFase").attr('disabled', habilitar);
		$("#estadoFase").attr('disabled', habilitar);
		$("#idProyectoFase").attr('disabled', habilitar);
	}
	
	function cargarFormFase(rowdata, row) {
		rowdata = $('#listaFases').getRowData(row);
		$("#idFase").val(rowdata.idFase);
		$("#nombreFase").val(rowdata.nombreFase);
		$("#datepickerFase").val(rowdata.fechaInicio);
		$("#datepickerFase2").val(rowdata.fechaFinalizacion);
		$("#descripcionFase").val(rowdata.descripcion);
		$("#estadoFase").val(rowdata.estado);
		$("#idProyectoFase").val(valorProyectoSeleccion());
		

	}
	
	function abrirDialogoMiembrosComite() {

		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			mostrarMensaje("Atencion",
					"Seleccione el proyecto a cual administrar Comite ");
			return;
		}
		var rowdata = $('#list').getRowData(rowProyecto);
		setAgregarMiembrosComite(rowdata);
		$('#dialogo-agregar-miembros-comite').dialog("open");
	}
	
	function setAgregarMiembrosComite(rowdata) {
		
		var myPostData = $('#listComite').jqGrid("getGridParam", "postData");
		delete myPostData.idProyecto;
		//eso borra el idFase actual
		$('#listComite').setGridParam({
		postData: { idProyecto: rowdata.idProyecto  } });
		//eso se setea el nuevo valor
		$('#listComite').trigger("reloadGrid");

	}


	
	function abrirDialogoMiembros() {

		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			mostrarMensaje("Atencion",
					"Seleccione el proyecto a cual administrar miembros ");
			return;
		}
		var rowdata = $('#list').getRowData(rowProyecto);
		setAgregarMiembros(rowdata); 
		$('#dialogo-agregar-miembros').dialog("open");
	}

	function setAgregarMiembros(rowdata) {
		
		myPostData = $('#listMiembros').jqGrid("getGridParam", "postData");
		delete myPostData.idProyecto;
		//eso borra el idFase actual 
		$('#listMiembros').setGridParam({
		postData: { idProyecto: rowdata.idProyecto  } });
		//eso se setea el nuevo valor
		$('#listMiembros').trigger("reloadGrid");
		return
	}
	
	$.enmascarar = function() {
		$('#presupuesto').number(true, 0);
		$('#nroFases').number(true, 0);
		//$("#presup7uesto").mask("", {placeholder : " "}); 
		//$("#nroFases").mask("?9999999999999", {placeholder : " "}); 
	}

	/* funcion para llamar al formulario agregar un nuevo datos */
	function agregar() {
		/* se indica que se cargará un nuevo dato */
		$.enmascarar();
		setBordeNormal();
		setCampoErrores();
		bandera = 1;
		/* se vacian los elementos HTML de captura de datos */
		$("#nombreProyecto").val("").attr('disabled', false);
		$("#idProjectLeader").val("").attr('disabled', false);
		$("#nombreProjectLeader").val("{{session['username']}}").attr(
				'disabled', true);
		$("#datepicker").val("").attr('disabled', false);
		$("#datepicker2").val("").attr('disabled', false);
		$("#presupuesto").val("").attr('disabled', false);
		$("#lNroFases").text("");
		$("#nroFases").val("0").hide().attr('disabled', false);
		$("#observacion").val("").attr('disabled', false);
		$("#lEstado").text("");
		$("#estado").val("").hide().attr('disabled', true);
		/* se llama al dialogo de captura de datos */
		$("#dialogo-proyecto").dialog("open");
	}

	/* funcion para llamar al formulario para la modificación de datos */
	function modificar() {
		/* se indica que el dato no es nuevo */
		var row = $('#list').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione la fila a modificar");
			return;
		}
		
		var rowdata = $('#list').getRowData(row);
		
		if (rowdata.estado!="desarrollo"){
			mostrarMensaje("Atencion", "El proyecto ya no puede ser modificado");
			return 
		}
		
		bandera = 2;
		$.enmascarar();
		setBordeNormal();
		setCampoErrores();
		/* se comprueba que hay un dato seleccionado para modificar */
		
		/* se cargan los elementos HTML segun la fila seleccionada*/
		
		/*alert(rowdata.idProjectLeader)*/
		$("#idProyecto").val(rowdata.idProyecto).attr('disabled', false);
		$("#nombreProyecto").val(rowdata.nombreProyecto)
				.attr('disabled', false);
		$("#idProjectLeader").val(rowdata.idProjectLeader).attr('disabled',
				false);
		$("#nombreProjectLeader").val("{{session['username']}}").attr(
				'disabled', true);
		$("#datepicker").val(rowdata.fechaInicio).attr('disabled', false);
		$("#datepicker2").val(rowdata.fechaFinalizacion)
				.attr('disabled', false);
		$("#presupuesto").val(rowdata.presupuesto).attr('disabled', false);
		$("#nroFases").val(rowdata.nroFases).hide().attr('disabled', false);
		//$("#lNroFases").text("some value");
		$("#lNroFases").text("");
		$("#observacion").val(rowdata.observacion).attr('disabled', false);
		$("#estado").val(rowdata.estado).hide().attr('disabled', false);
		$("#lEstado").text("");
		/* se llama al dialogo para modificar los datos */
		$("#dialogo-proyecto").dialog("open");
	}

	function consultar() {
		/* se indica que el dato no es nuevo */
		bandera = 3;
		$.enmascarar();
		setBordeNormal();
		setCampoErrores();
		/* se comprueba que hay un dato seleccionado para modificar */
		var row = $('#list').jqGrid('getGridParam', 'selrow');
		if (row == null) {
			mostrarMensaje("Atencion", "Seleccione la fila a consultar");
			return;
		}
		/* se cargan los elementos HTML segun la fila seleccionada*/
		var rowdata = $('#list').getRowData(row);
		$("#idProyecto").val(rowdata.idProyecto).attr('disabled', true);
		$("#nombreProyecto").val(rowdata.nombreProyecto).attr('disabled', true);
		$("#idProjectLeader").val("{{session['username']}}").attr('disabled',
				true);
		$("#nombreProjectLeader").val(rowdata.nombreProjectLeader).attr(
				'disabled', true);
		$("#datepicker").val(rowdata.fechaInicio).attr('disabled', true);
		$("#datepicker2").val(rowdata.fechaFinalizacion).attr('disabled', true);
		$("#presupuesto").val(rowdata.presupuesto).attr('disabled', true);
		$("#lNroFases").text("Cantidad de fases");
		$("#nroFases").val(rowdata.nroFases).show().attr('disabled', true);
		$("#observacion").val(rowdata.observacion).attr('disabled', true);
		$("#lEstado").text("Estado");
		$("#estado").val(rowdata.estado).show().attr('disabled', true);
		/* se llama al dialogo para modificar los datos */
		$("#dialogo-proyecto").dialog("open");
	}
	
	function activarProyecto(){
		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			mostrarMensaje("Error", "Debe seleccionar un proyecto para activarlo")
		}else{
			var rowdata = $('#list').getRowData(rowProyecto);
			if(rowdata.estado!="desarrollo"){
				mostrarMensaje("Error", "Este proyecto ya ha sido activado anteriormente")
			}else{
				
					$.post('/activarProyecto/',{
												
												idProyecto: rowdata.idProyecto
												},
												function(data, status) {
													if (data.substring(0, 1) == 't') {
														mostrarMensaje(
																"Error","Los datos no se han podido guardar:\n"
																		+ data.substring(2));
												
													} else {
														mostrarMensaje(
																"Exito",
																data
																		.substring(2));
													}
												
													$('#list')
															.trigger(
																	"reloadGrid");
												});	
			}
			
		}
		
	}
	
	function finalizarProyecto(){
		var rowProyecto = $('#list').jqGrid('getGridParam', 'selrow');
		if (rowProyecto == null) {
			mostrarMensaje("Error", "Debe seleccionar un proyecto a finalizar")
		}else{
			var rowdata = $('#list').getRowData(rowProyecto);
			
			if(rowdata.estado!="activo"){
				mostrarMensaje("Error", "El proyecto debe estar en estado activo para ser fiinalizado")
			}else{
				$.post('/finalizarProyecto/',{
					
					idProyecto: rowdata.idProyecto
					},
					function(data, status) {
						if (data.substring(0, 1) == 't') {
							mostrarMensaje(
									"Error","Los datos no se han podido guardar:\n"
											+ data.substring(2));
					
						} else {
							mostrarMensaje(
									"Exito",
									data
											.substring(2));
						}
					
						$('#list')
								.trigger(
										"reloadGrid");
					});	
		
				
				
				
				
			}
			
		}
		
		
	}

	function setBordeNormal() {
		$("#nombreProyecto").css('border-color', 'skyblue');
		$("#datepicker").css('border-color', 'skyblue');
		$("#datepicker2").css('border-color', 'skyblue');
		$("#presupuesto").css('border-color', 'skyblue');
		$("#nroFases").css('border-color', 'skyblue');
		$("#observacion").css('border-color', 'skyblue');
	}

	function setCampoErrores() {
		$("#EnombreProyecto").val("");
		$("#Edatepicker").val("");
		$("#Edatepicker2").val("");
		$("#Epresupuesto").val("");
		$("#EnroFases").val("");
		$("#Eobservacion").val("");
	}

	function control() {
		setCampoErrores();
		setBordeNormal();
		var error = 0;
		var len;

		len = $("#nombreProyecto").val().trim().length;
		if (len > 20 || len <= 0) {
			$("#nombreProyecto").css('border-color', 'red');
			$("#EnombreProyecto").val("Campo Obligario. Long. max 20").css(
					'color', 'red');
			error = 1;
		}

		len = $("#datepicker").val().trim().length;
		if (len <= 0) {
			$("#datepicker").css('border-color', 'red');
			$("#Edatepicker").val("Campo Obligario.").css('color', 'red');
			error = 1;
		}
		len = $("#datepicker2").val().trim().length;
		if (len <= 0) {
			$("#datepicker2").css('border-color', 'red');
			$("#Edatepicker2").val("Campo Obligario.").css('color', 'red');
			error = 1;
		}
		if ($("#datepicker2").val() <= $("#datepicker").val()) {
			$("#datepicker2").css('border-color', 'red');
			$("#Edatepicker2").val("Debe ser mayor a Fch. inicio").css('color',
					'red');

		}
		len = document.getElementById("observacion").value.trim().length;
		//len=$("#observacion").val().trim().length;
		if (len > 50) {
			$("#observacion").css('border-color', 'red');
			$("#Eobservacion").val("Long max 50").css('color', 'red');
			error = 1;
		}
		return error;
	}

	function mostrarMensaje(titulo, mensaje) {
		$('#msgbox').text(mensaje);
		$('#msgbox').dialog({
			title : titulo,
			modal : true,
			show : {
				effect : 'fade',
				duration : 250
			},
			hide : {
				effect : 'fade',
				duration : 200
			},
			buttons : {
				"Ok" : function() {
					$(this).dialog("close");
				}
			}
		});
	}
</script>
<div id='msgbox' title='' style='display: none'></div>

<div id="dialogo-fases" title="Administrar fases de Proyecto">
	<table id="listaFases"></table>
	<div id="pagerFases"></div>
</div>
<div id="dialogo-datos-fase" title="Datos de Fase">
	<form title="(*) campos obligatorios">
		<fieldset class="fieldset">
			<input type="hidden" name="idFase" id="idFase" />
			<table>
				<tr>
					<td><label for="nombreFase" style="display: block">*Nombre Fase</label> 
						<input type="text" name="nombreFase"
						id="nombreFase" class="text ui-widget-content ui-corner-all"
						style="display: block; margin-bottom: 12px; padding: 0.4em; width: 80%;" />
					</td>
				</tr>
				
				<tr>
					<td>
						<label for="fechaInicio" style="display: block">*Fecha de Inicio</label>
						 <input type="text" name="datepickerFase" id="datepickerFase" readonly="readonly"
						class="text ui-widget-content ui-corner-all"
						style="display: block; margin-bottom: 12px; padding: 0.4em; width: 100%;" />
					</td>
				</tr>
				<tr>
					<td>
						<label for="fechaFinalizacion" style="display: block">*Fecha de Finalizacion</label> 
						<input type="text" name="datepickerFase2" id="datepickerFase2" readonly="readonly"
						class="text ui-widget-content ui-corner-all"
						style="display: block; margin-bottom: 12px; padding: 0.4em; width: 100%;" />
					</td>
						
				</tr>
				<tr>
					<td><label for="descripcion" style="display: block">*Descripcion</label>
						<textarea id="descripcionFase"
							class="text ui-widget-content ui-corner-all"
							style="display: block; margin-bottom: 12px; padding: 0.4em; width: 80%;">
						</textarea></td>
					<td>
						<div id="estadoFaseDiv">
						<label for="estado" style="display: block">*Estado</label>
						<select id="estadoFase"
						style="display: block; margin-bottom: 12px; padding: 0.4em; width: 100%;"
						class="ui-widget-content ui-corner-all">
							<option value="desarrollo">Desarrollo</option>
							<option value="activo">Activo</option>
							<option value="finalizado">Finalizado</option>
						</select>
						</div>
					</td>
					<input type="hidden" name="idProyectoFase" id="idProyectoFase" />
				</tr>
			</table>
		</fieldset>
	</form>
</div>


<div id="dialogo-listaItems">
	<table id="listaItems"></table>
<div id="pagerItems"></div>
</div>

<div id="dialogo-agregar-miembros-comite" title="Agregar Miembros a Proyecto">
	<table id="listComite"></table>
	<div id="pagerComite"></div>
</div>
<div id="dialogo-agregar-miembros" title="Agregar Miembros a Proyecto">
	<table id="listMiembros"></table>
	<div id="pagerMiembros"></div>
</div>

<div style="margin-left: auto; margin-right: auto; width: 100%;">
	<h2>Administracion de Proyectos</h2>
	<table id="list"></table>
	<div id="pager"></div>
		<br></br> 
		

	
		<input id="btAgregar" type="button" name="nuevo"
		value="Nuevo" onclick='agregar()' /> 
		<input id="btModificar" type="button" name="detalle" 
		onclick='modificar();' value="Modificar" />
		<input id="btConsultar" type="button" name="consultar"
		value="Consultar" onclick='consultar()' /> 
		<input id="btFases" type="button" name="btFases"
		value="Fases" onclick='abrirDialogoFases()' />
		<input id="btAgregarMiembros" type="button" name="agregarMiembros"
		value="Miembros" onclick='abrirDialogoMiembros()' />
		<input id="btAgregarMiembrosComite" type="button" name="agregarMiembrosComite"
		value="Comite de Cambios" onclick='abrirDialogoMiembrosComite()' />
		<input id="btRoles" type="button" name="btRoles"
		value="Roles" onclick='cargaComboFase()' />
		<input id="btRolUser" type="button" name="btRolUser"
		value="Asignar roles a Usuario" onclick='cargaComboUsuario()' /> <br></br>
		<input id="btFinalizarPy" type="button" name="btFinalizarPy"
		value="Finalizar Proyecto" onclick='finalizarProyecto()' />
		<input id="btActivarPy" type="button" name="btActivarPy"
		value="Activar Proyecto" onclick='activarProyecto()' />
	<script>
		$("#btFinalizarPy").button();
		$("#btActivarPy").button();
		$("#btAgregar").button();
		$("#btModificar").button();
		$("#btConsultar").button();
		$("#btAgregarMiembros").button();
		$("#btAgregarMiembrosComite").button();
		$("#btFases").button();
		$("#btRoles").button();
		$("#btRolUser").button();
	</script>
</div>


<div id="dialogo-rolUsuario" title="Asignar Roles a Usuario">
<label for="comboUsuario" style="display: block ; padding: 0.4em; float:left ">Asignar roles a: </label> 
<select id="comboUsuario" onchange="reloadGridRolProyecto()"
style="display: block; margin-bottom: 12px; padding: 0.4em;"
class="ui-widget-content ui-corner-all">
</select>
<table id="listRolUser"></table>
<div id="pagerRolUser"></div>
</div>

<div id="dialogo-roles" title="Administrar Roles del Proyecto">

<label for="comboFase" style="display: block ; padding: 0.4em; float:left ">Fase a administrar</label> 
<select id="comboFase" onchange="reloadGridRol()"
style="display: block; margin-bottom: 12px; padding: 0.4em;"
class="ui-widget-content ui-corner-all">
</select>
<table id="listRoles"></table>
<div id="pagerRoles"></div>
</div>



<div id="dialogo-rolProyecto" title="Roles de proyecto">
	<form title="(*) campos obligatorios">
		<fieldset class="fieldset">

			<input type="hidden" name="idRol" id="idRol" />
			<table id="table1c" style="float: left; padding: 0.4em;">
				<tr>
					<td><label for="nombreRol" style="display: block">*Nombre del Rol</label>
						<input title="20 caracteres max" type="text" name="nombreRol"
						id="nombreRol"
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
					<td><br></br> <input title="20 caracteres max" readonly
						tabIndex="-1" type="text" name="EnombreRol"
						id="EnombreRol"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>
				<tr>
					<td><label for="descripcionRol" style="display: block">*Descripcion</label>
						<textarea type="text" name="descripcionRol" id="descripcionRol"
						style="width: 200px; display: block; margin-bottom: 12px; padding: 0.4em;"> </textarea></td>
					<td><br></br> <input title="20 caracteres max" readonly
						tabIndex="-1" type="text" name="EdescripcionRol"
						id="EdescripcionRol"
						style="width: 200px; border: none; display: block; margin-bottom: 12px; padding: 0.4em;" />
					</td>
				</tr>
				
			</table>
		</fieldset>
		
	</form>
</div>
<div id="dialogo-permisos">
<table id="listPermisos"></table>
<div id="pagerPermisos"></div>
</div>


{% endblock %}
</html>